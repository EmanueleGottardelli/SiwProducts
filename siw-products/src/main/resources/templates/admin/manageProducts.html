<!DOCTYPE html>
<html lang="it">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>SiwProduct - Gestione Prodotti</title>

	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

	<link rel="stylesheet" href="/css/stile.css" />
</head>

<body class="bg-light">

	<!-- Navbar -->
	<header>
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
			<div class="container-fluid">
				<a class="navbar-brand" href="/">SiwProduct</a>
				<div class="d-flex">
					<div th:if="${userDetails}">
						<span class="navbar-text text-white me-3" th:text="${userDetails.username}"></span>
						<a class="btn btn-outline-light" href="/logout">Logout</a>
					</div>
					<div th:unless="${userDetails}">
						<a class="btn btn-outline-light" href="/login">Login</a>
					</div>
				</div>
			</div>
		</nav>
	</header>

	<!-- Logo -->
	<div class="text-center mt-4">
		<a href="/"><img src="/images/logo.png" class="img-fluid" style="max-width: 35%;" alt="Logo"></a>
	</div>

	<!-- Contenuto -->
	<main class="container mt-5">
		<h1 class="text-center mb-4">Catalogo Prodotti</h1>

		<div th:if="${products.isEmpty()}" class="alert alert-warning text-center">
			Non ci sono prodotti nel catalogo
		</div>

		<div th:if="${products}" class="table-responsive">
			<table class="table table-striped table-hover shadow-sm">
				<thead class="table-dark">
					<tr>
						<th scope="col">Nome</th>
						<th scope="col">Prezzo (â‚¬)</th>
						<th scope="col" class="text-center">Azioni</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="product : ${products}">
						<td th:text="${product.name}">Prodotto</td>
						<td th:text="${product.price}">00.00</td>
						<td class="text-center">
							<a th:href="@{/admin/formUpdateProduct/{id}(id=${product.id})}"
								class="btn btn-primary btn-sm me-2">Aggiorna</a>
							<form th:action="@{/admin/deleteProduct/{product_id}(product_id=${product.id})}"
								method="post" style="display:inline">
								<button type="submit" class="btn btn-danger btn-sm">Elimina</button>
							</form>
							<!-- Sezione gestione simili -->
							<div class="mt-3">
								<strong>Prodotti simili:</strong>
								<ul class="list-unstyled mt-2">
									<li th:each="s : ${product.similarProducts}">
										<span th:text="${s.name}"></span>
										<form th:action="@{/admin/product/{id}/removeSimilar(id=${product.id})}"
											method="post" style="display:inline">
											<input type="hidden" name="similarId" th:value="${s.id}" />
											<button type="submit"
												class="btn btn-outline-danger btn-sm ms-2">Rimuovi</button>
										</form>
									</li>
								</ul>

								<!-- Aggiunta nuovo simile -->
								<form th:action="@{/admin/product/{id}/addSimilar(id=${product.id})}" method="post"
									class="d-flex mt-2">
									<select class="form-select form-select-sm me-2" name="similarId">
										<option th:each="p : ${products}" th:value="${p.id}" th:text="${p.name}">
										</option>
									</select>
									<button type="submit" class="btn btn-outline-success btn-sm">Aggiungi</button>
								</form>
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</main>

	<!-- Bootstrap JS -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>